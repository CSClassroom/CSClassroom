@{
    ViewData["Title"] = "Download Project Checkpoint Submissions";
}

@model CSC.CSClassroom.WebApp.ViewModels.Submission.DownloadSubmissionViewModel

@if (Model.IndexForSectionStudentsView == -1)
{
    <h2>Download @Project.Name @Checkpoint.DisplayName Submissions</h2>
}
else
{
    <h2>Select Students To Download From @Model.SectionStudents[Model.IndexForSectionStudentsView].SectionName.Text</h2>
}


<form asp-action="DownloadSubmissions">
    <div class="form-horizontal">
        <hr />
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="@Model.HideMainForm">
            <label asp-for="Format" class="col-md-2 control-label"></label>
            <div class="col-md-10">
                <p asp-description-for="Format" class="form-control-static"></p>
                <select asp-for="Format" asp-items="Html.GetEnumSelectList<DownloadFormat>()"></select>
                <span asp-validation-for="Format" class="text-danger"></span>
            </div>
        </div>

        <div class="@Model.HideMainForm">
            <label asp-for="SectionStudents" class="col-md-2 control-label"></label>
            <div class="col-md-10">
                <p asp-description-for="SectionStudents" class="form-control-static"></p>
                <table class="table-condensed">
                    @for (int i = 0; i < Model.SectionStudents.Count; i++)
                    {
                        <tr>
                            <td>
                                <input type="checkbox" asp-for="@Model.SectionStudents[i].SectionName.Selected" onchange="onCheckboxChanged(this, @Html.IdFor(model => model.SectionStudents[i].SubmitButton) )" />
                            </td>
                            <td>
                                @Model.SectionStudents[i].SectionName.Text
                                <input type="hidden" asp-for="@Model.SectionStudents[i].SectionName.Text" />
                                <input type="hidden" asp-for="@Model.SectionStudents[i].SectionName.Value" />
                            </td>
                            <td>
                                <input asp-for="@Model.SectionStudents[i].SubmitButton" type="submit"
                                       value="@Model.SectionStudents[i].StudentDisplayList" class="btn btn-link" />
                            </td>

                            @*
                                               id="@Model.SectionStudents[i].ChangeStudentDisplayListButton"
                                               name="@Model.SectionStudents[i].ChangeStudentDisplayListButton"

                <a asp-controller="Submission"
                   asp-action="SelectSectionStudents"
                   asp-route-selectSectionName="@Model.SectionStudents[i].SectionName.Text">@Model.SectionStudents[i].SelectSectionStudentsURL</a>
                            *@
                        </tr>
                    }
                </table>
            </div>
        </div>

        <div class="@Model.HideMainForm">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Download" class="btn btn-default" />
            </div>
        </div>

        <script type="text/javascript">
            window.onload = onLoad();

            function onLoad()
            {
                @for (int i = 0; i < Model.SectionStudents.Count; i++)
                {
                    @:onCheckboxChanged(@Html.IdFor(model => model.SectionStudents[i].SectionName.Selected), @Html.IdFor(model => model.SectionStudents[i].SubmitButton));
                }
            }

            function onCheckboxChanged(checkbox, selectStudentsButton)
            {
                //alert("onCheckboxChanged: " + selectStudentsButton.className);
                selectStudentsButton.className = checkbox.checked ? "btn btn-link" : "hidden";

                @* var selectStudentsButton = @Html.IdFor(model => model.SectionStudents[i].SubmitButton); *@
            }
        </script>


        @*

                onchange="onFormatChanged()"
                <!--
            <script type="text/javascript">

                function onFormatChanged()
                {
                    var formatListId = @Html.IdFor(model => model.Format);
                    var formatList = $('#' + formatListId);

                    // TODO: don't hard-code string here
                    var formatAllSelected = (formatList.value == "All");

                    @for (int i = 0; i < Model.SectionNames.Count; i++)
                    {
                        @:var curCheckboxId = @Html.IdFor(model => model.SectionNames[i].Selected);
                        @:var curCheckbox = $('#' + curCheckboxId);
                        if (i == Model.CurrentSection.Index)
                        {

                            @:curCheckbox.checked = true;
                        }
                        else
                        {
                            @:curCheckbox.checked = false;
                        }
                    }
                }
            </script>
                -->
        *@

        @{ /*
                           <div class="form-group">
                               <label asp-for="SectionName" class="col-md-2 control-label"></label>
                               <div class="col-md-10">
                                   <p asp-description-for="SectionName" class="form-control-static"></p>
                                   <select asp-for="SectionName" class="form-control" asp-items="ViewBag.SectionNames"></select>
                               </div>
                           </div>
                           <div class="form-group">
                               <label asp-for="AssignmentGroupName" class="col-md-2 control-label"></label>
                               <div class="col-md-10">
                                   <p asp-description-for="AssignmentGroupName" class="form-control-static"></p>
                                   <select asp-for="AssignmentGroupName" class="form-control" asp-items="ViewBag.AssignmentGroups"></select>
                               </div>
                           </div>
                           <div class="form-group">
                               <label asp-for="GradebookName" class="col-md-2 control-label"></label>
                               <div class="col-md-10">
                                   <p asp-description-for="GradebookName" class="form-control-static"></p>
                                   <select asp-for="GradebookName" class="form-control" asp-items="ViewBag.GradebookNames"></select>
                               </div>
                           </div>

                                   */
        }
    </div>
</form>
